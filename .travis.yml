if: branch = master

language: go
go:
  - 1.11.x

addons:
  ssh_known_hosts: johnjago.com

install:
  - mkdir $HOME/src
  - cd $HOME/src
  - git clone https://github.com/gohugoio/hugo.git
  - cd hugo
  - go install
  - cd $TRAVIS_BUILD_DIR

script:
  - mkdir -p dist/blog/
  - cd src/blog/ && hugo && mv public/* ../../dist/blog/ && cd ..
  - rsync -av --exclude=blog/ --exclude=favicon.png . ../dist/
  - cd ..

before_deploy:
  - eval "$(ssh-agent -s)"
  - echo $KEY | tr -d '\r' | ssh-add - > /dev/null

deploy:
  provider: script
  script: rsync --dry-run -azvP --delete dist/ $USER@johnjago.com:$WWW/
